---
title: "p8105_hw2_yw3996"
author: "Yiying Wu"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load R packages
```{r,include=TRUE,message = FALSE}
library(tidyverse)
library(readxl)
```


## Problem 1: FiveThirtyEight data
### `pols-month.csv`
Clean the data in `pols-month.csv`: 

* Use `separate()` to break up the variable `mon` into integer variables `year`, `month`, and `day` 
* Replace month number with month name
* Create a `president` variable taking values `gop` and `dem`, and remove `prez_dem` and `prez_gop` 
* Remove the `day` variable.
```{r}
pols_month = read_csv("./fivethirtyeight_datasets/pols-month.csv")|>
  janitor::clean_names()|>
  separate(mon,into=c("year","month","day"),)|>
  mutate(month = month.name[as.numeric(month)],
         president=case_match(
           prez_dem,
           1~"democratic",
           0~"republican"
           )
        )|>
  select(-prez_dem,-prez_gop,-day)

pols_month
```

### `snp.csv`
Clean the data in `snp.csv` using a similar process to the above. 

* arrange according to year and month
* organize so that year and month are the leading columns
```{r}
snp = read_csv("./fivethirtyeight_datasets/snp.csv")|>
  janitor::clean_names()|>
  mutate(
    date=ifelse(as.Date(date,"%m/ %d/ %y")> Sys.Date(),
                format(as.Date(date,"%m/ %d/ %y"),'19%y-%m-%d'),
                format(as.Date(date,"%m/ %d/ %y"),'%Y-%m-%d'))
        )|>
  separate(date,into=c("year","month","day"),)|>
  mutate(month = month.name[as.numeric(month)])|>
  select(year,month, everything(),-day)

snp
```

### `unemployment`
tidy the `unemployment` data so that it can be merged with the previous datasets: 

* switching from “wide” to “long” format
* ensuring that key variables have the same name
* ensuring that key variables take the same values
```{r}
unemployment = read_csv("./fivethirtyeight_datasets/unemployment.csv")|>
  pivot_longer(
    Jan:Dec,
    names_to = "month", 
    values_to = "unemployment")|>
  janitor::clean_names()|>
  mutate(month=month.name[match(month,month.abb)])|>
  mutate(year=as.character(year))

unemployment
```

Join the datasets by merging `snp` into `pols_month`, and merging `unemployment` into the result.
```{r}
df=pols_month|>
  left_join(snp,by=c("year", "month"))|>
  left_join(unemployment, by=c("year", "month"))

df
```

### description of datasets
* `pols_month`: pols_month is a 822 × 9 dataset with variable `year`, `month`, `gov_gop`, `sen_gop`, `rep_gop`, `gov_dem`, `sen_dem`, `rep_dem`, `president`. The `year` variable in this dataset ranges from `r min(pols_month$year)` to `r max(pols_month$year)`.
* `snp`: snp is a 787 × 3 dataset with variable `year`, `month`, `close`. The `year` variable in this dataset ranges from `r min(snp$year)` to `r max(snp$year)`.
* `unemployment`: unemployment is a 816 × 3 dataset with variable `year`, `month`, `unemployment`. The `year` variable in this dataset ranges from `r min(unemployment$year)` to `r max(unemployment$year)`.
* `df`: the joined dataset df is a 822 × 11 dataset with variable `year`, `month`, `gov_gop`, `sen_gop`, `rep_gop`, `gov_dem`, `sen_dem`, `rep_dem`, `president`, `close`, `unemployment`. The `year` variable in this dataset ranges from `r min(df$year)` to `r max(df$year)`.


## Problem 2: Mr. Trash Wheel dataset
Read and clean the Mr. Trash Wheel sheet:

* specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in `read_excel`
* use reasonable variable names
* omit rows that do not include dumpster-specific data
* update the data to include a new homes_powered variable based on Homes Powered - Each ton of trash equates to on average 500 kilowatts of electricity.  An average household will use 30 kilowatts per day..
```{r}
mr_trash_wheel = read_excel(
  "202207 Trash Wheel Collection Data.xlsx", 
  sheet="Mr. Trash Wheel", range = cell_cols("A:N"))|>
  janitor::clean_names()|>
  filter(row_number() <= n()-1)|>
  mutate(homes_powered=weight_tons*500/30)

mr_trash_wheel
```

Use a similar process to import, clean, and organize the data for `professor_trash_wheel`
```{r}
professor_trash_wheel = read_excel(
  "202207 Trash Wheel Collection Data.xlsx", 
  sheet="Professor Trash Wheel", range = cell_cols("A:M"))|>
  janitor::clean_names()|>
  filter(row_number() <= n()-1)|>
  mutate(homes_powered=weight_tons*500/30)

professor_trash_wheel
```

Use a similar process to import, clean, and organize the data for `gwynnda`
```{r}
gwynnda = read_excel(
  "202207 Trash Wheel Collection Data.xlsx", 
  sheet="Gwynnda Trash Wheel", range = cell_cols("A:K"))|>
  janitor::clean_names()|>
  filter(row_number() <= n()-2)|>
  mutate(homes_powered=weight_tons*500/30)

gwynnda
```

combine these with the Mr. Trash Wheel dataset to produce a single tidy dataset `mr_trash_wheel_tidy`. To keep track of which Trash Wheel is which, add an additional variable `trash_wheel` to all datasets before combining.
```{r}
mr_trash_wheel=mr_trash_wheel|>
  mutate(trash_wheel="Mr. Trash Wheel")

professor_trash_wheel=professor_trash_wheel|>
  mutate(trash_wheel="Professor Trash Wheel",
         year=as.character(year))

gwynnda=gwynnda|>
  mutate(trash_wheel="Gwynnda Trash Wheel",
         year=as.character(year))

mr_trash_wheel_tidy = 
  bind_rows(mr_trash_wheel, professor_trash_wheel, gwynnda) |>
  janitor::clean_names() |>
  select(trash_wheel, everything()) 

mr_trash_wheel_tidy
```

